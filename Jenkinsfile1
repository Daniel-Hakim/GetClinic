node {
        
	stage('pull-source') {
        cleanWs()     
        checkout([$class: 'GitSCM', branches: [[name: '*/master']], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'petclinic.git'], [$class: 'RelativeTargetDirectory', relativeTargetDir: 'ansible-aws-playbooks.git']], submoduleCfg: [], userRemoteConfigs: [[credentialsId: 'c7e60db1-4689-46b7-92dc-1cd7ffcc3f16', url: 'git@github.com:chaitu-papa/petclinic.git'], [credentialsId: 'c7e60db1-4689-46b7-92dc-1cd7ffcc3f16', url: 'git@github.com:chaitu-papa/ansible-aws-playbooks.git']]])
	}
	stage('compile-unit-test') {
      // Run the gradle build
      	if (isUnix()) {
		    sh 'chmod +x petclinic.git/gradlew'
        	sh 'cd petclinic.git;./gradlew clean build'
        	hygieiaBuildPublishStep buildStatus: 'InProgress'
      }
   }
   	stage('code-coverage') {
      // Run the gradle build
      	if (isUnix()) {
       		sh 'chmod +x gradlew'
         	sh "./gradlew jacocoTestReport"
      } 
   }
	stage('code-analysis') {
      // Run the gradle sonar
      	if (isUnix()) {
          withCredentials([string(credentialsId: 'sonar-token', variable: 'Sonar_token')]) {
        	sh "cd petclinic.git;./gradlew sonarqube -Dsonar.host.url=$env.SONAR_URL -Dsonar.login=$Sonar_token" }
        	hygieiaBuildPublishStep buildStatus: 'InProgress'
       } 
   }
   	stage('artifact-publish') {
      // Run the gradle upload
      	if (isUnix()) {
       		env.SNAPSHOT="SNAPSHOT"
        	env.BUILD_NUM="$env.BUILD_NUMBER"
        	sh 'chmod +x petclinic.git/gradlew'
        	sh "cd petclinic.git;./gradlew upload --info"
        	hygieiaBuildPublishStep buildStatus: 'InProgress'
        	hygieiaArtifactPublishStep artifactDirectory: 'petclinic.git/build/libs/', artifactGroup: 'org.springframework.samples', artifactName: '*.war', artifactVersion: '1.0.1'
	        hygieiaDeployPublishStep applicationName: 'app_name', artifactDirectory: 'petclinic.git/build/libs/', artifactGroup: 'org.springframework.samples', artifactName: '*.war', artifactVersion: '1.0.1', buildStatus: 'InProgress', environmentName: "BAKE"
      } 
   }
}

